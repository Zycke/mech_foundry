<form class="{{cssClass}} mech-foundry item-sheet weapon-sheet" autocomplete="off">
  <header class="sheet-header">
    <img class="item-img" src="{{item.img}}" data-edit="img" title="{{item.name}}"/>
    <div class="header-fields">
      <h1 class="item-name">
        <input name="name" type="text" value="{{item.name}}" placeholder="Weapon Name"/>
      </h1>
    </div>
  </header>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="details">Details</a>
    <a class="item" data-tab="effects">Effects</a>
    <a class="item" data-tab="description">Description</a>
  </nav>

  <section class="sheet-body">
    <div class="tab details" data-group="primary" data-tab="details">
      <div class="form-row">
        <div class="form-group">
          <label>Weapon Type</label>
          <select name="system.weaponType">
            <option value="melee" {{#if (eq system.weaponType "melee")}}selected{{/if}}>Melee</option>
            <option value="archaic" {{#if (eq system.weaponType "archaic")}}selected{{/if}}>Archaic</option>
            <option value="smallarms" {{#if (eq system.weaponType "smallarms")}}selected{{/if}}>Small Arms</option>
            <option value="support" {{#if (eq system.weaponType "support")}}selected{{/if}}>Support</option>
            <option value="explosives" {{#if (eq system.weaponType "explosives")}}selected{{/if}}>Explosives</option>
          </select>
        </div>
        <div class="form-group">
          <label>Skill</label>
          <select name="system.skill">
            <option value="" {{#unless system.skill}}selected{{/unless}}>-- Select --</option>
            <option value="Melee Weapons" {{#if (eq system.skill "Melee Weapons")}}selected{{/if}}>Melee Weapons</option>
            <option value="Archery" {{#if (eq system.skill "Archery")}}selected{{/if}}>Archery</option>
            <option value="Small Arms (Pistols)" {{#if (eq system.skill "Small Arms (Pistols)")}}selected{{/if}}>Small Arms (Pistols)</option>
            <option value="Small Arms (SMGs)" {{#if (eq system.skill "Small Arms (SMGs)")}}selected{{/if}}>Small Arms (SMGs)</option>
            <option value="Small Arms (Rifles)" {{#if (eq system.skill "Small Arms (Rifles)")}}selected{{/if}}>Small Arms (Rifles)</option>
            <option value="Support Weapons" {{#if (eq system.skill "Support Weapons")}}selected{{/if}}>Support Weapons</option>
            <option value="Artillery" {{#if (eq system.skill "Artillery")}}selected{{/if}}>Artillery</option>
            <option value="Thrown Weapons" {{#if (eq system.skill "Thrown Weapons")}}selected{{/if}}>Thrown Weapons</option>
            <option value="Demolitions" {{#if (eq system.skill "Demolitions")}}selected{{/if}}>Demolitions</option>
          </select>
        </div>
        <div class="form-group">
          <label>Equipment Rating</label>
          <input type="text" name="system.equipmentRating" value="{{system.equipmentRating}}" placeholder="e.g., C/A-A-A/C"/>
        </div>
      </div>

      <h3>Damage</h3>
      <div class="form-row">
        <div class="form-group">
          <label>AP</label>
          <input type="number" name="system.ap" value="{{system.ap}}" data-dtype="Number"/>
        </div>
        <div class="form-group">
          <label>AP Factor</label>
          <select name="system.apFactor">
            <option value="B" {{#if (eq system.apFactor "B")}}selected{{/if}}>B - Ballistic</option>
            <option value="E" {{#if (eq system.apFactor "E")}}selected{{/if}}>E - Energy</option>
            <option value="M" {{#if (eq system.apFactor "M")}}selected{{/if}}>M - Melee</option>
            <option value="S" {{#if (eq system.apFactor "S")}}selected{{/if}}>S - Special</option>
            <option value="X" {{#if (eq system.apFactor "X")}}selected{{/if}}>X - Explosive</option>
          </select>
        </div>
        <div class="form-group">
          <label>BD</label>
          <input type="number" name="system.bd" value="{{system.bd}}" data-dtype="Number"/>
        </div>
        <div class="form-group">
          <label>BD Factor</label>
          <select name="system.bdFactor" class="bd-factor-select">
            <option value="" {{#unless system.bdFactor}}selected{{/unless}}>None</option>
            <option value="A" {{#if (eq system.bdFactor "A")}}selected{{/if}}>A - Area-Effect</option>
            <option value="B" {{#if (eq system.bdFactor "B")}}selected{{/if}}>B - Burst-Fire</option>
            <option value="C" {{#if (eq system.bdFactor "C")}}selected{{/if}}>C - Continuous</option>
            <option value="D" {{#if (eq system.bdFactor "D")}}selected{{/if}}>D - Subduing</option>
            <option value="S" {{#if (eq system.bdFactor "S")}}selected{{/if}}>S - Splash</option>
          </select>
        </div>
        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" name="system.subduing" {{#if system.subduing}}checked{{/if}}/>
            Subduing
          </label>
        </div>
      </div>

      {{!-- Burst Fire Fields - conditionally shown --}}
      <div class="form-row burst-fire-fields" {{#unless (eq system.bdFactor "B")}}style="display: none;"{{/unless}}>
        <div class="form-group">
          <label>Recoil</label>
          <input type="number" name="system.recoil" value="{{system.recoil}}" data-dtype="Number" min="0"/>
        </div>
        <div class="form-group">
          <label>Burst Rating</label>
          <input type="number" name="system.burstRating" value="{{system.burstRating}}" data-dtype="Number" min="1"/>
        </div>
      </div>

      <h3>Range (meters)</h3>
      <div class="range-fields form-row">
        <div class="form-group">
          <label>PB</label>
          <input type="number" name="system.range.pointBlank" value="{{system.range.pointBlank}}" data-dtype="Number"/>
        </div>
        <div class="form-group">
          <label>Short</label>
          <input type="number" name="system.range.short" value="{{system.range.short}}" data-dtype="Number"/>
        </div>
        <div class="form-group">
          <label>Medium</label>
          <input type="number" name="system.range.medium" value="{{system.range.medium}}" data-dtype="Number"/>
        </div>
        <div class="form-group">
          <label>Long</label>
          <input type="number" name="system.range.long" value="{{system.range.long}}" data-dtype="Number"/>
        </div>
        <div class="form-group">
          <label>Extreme</label>
          <input type="number" name="system.range.extreme" value="{{system.range.extreme}}" data-dtype="Number"/>
        </div>
      </div>

      <h3>Ammunition</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Magazine Capacity <span class="hint-inline">(Ballistic/Ordnance)</span></label>
          <input type="number" name="system.ammo.max" value="{{system.ammo.max}}" data-dtype="Number" min="0"/>
        </div>
        <div class="form-group">
          <label>Power Per Shot <span class="hint-inline">(Energy)</span></label>
          <input type="number" name="system.pps" value="{{system.pps}}" data-dtype="Number" min="0"/>
        </div>
      </div>
      <p class="hint">Ballistic/Ordnance weapons use Magazine Capacity. Energy weapons use Power Per Shot (PPS) with power packs.</p>

      {{!-- Ammo Compatibility Tags --}}
      <div class="form-group full-width">
        <label>Ammo Compatibility Tags</label>
        <div class="compatibility-tags">
          {{#each system.ammoCompatibility}}
          <div class="tag-item" data-index="{{@index}}">
            <input type="text" name="system.ammoCompatibility.{{@index}}" value="{{this}}"/>
            <a class="remove-ammo-tag" data-index="{{@index}}" title="Remove"><i class="fas fa-times"></i></a>
          </div>
          {{/each}}
          <a class="add-ammo-tag" title="Add Tag"><i class="fas fa-plus"></i> Add Tag</a>
        </div>
        <p class="hint">Tags for compatible ammo types: slug-thrower, rifle, shotgun, energy, laser, grenade-launcher, etc.</p>
      </div>

      <h3>Cost & Weight</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Cost (C-bills)</label>
          <input type="number" name="system.cost" value="{{system.cost}}" data-dtype="Number" min="0"/>
        </div>
        <div class="form-group">
          <label>Reload Cost</label>
          <input type="number" name="system.reloadCost" value="{{system.reloadCost}}" data-dtype="Number" min="0"/>
        </div>
        <div class="form-group">
          <label>Mass (kg)</label>
          <input type="number" name="system.mass" value="{{system.mass}}" data-dtype="Number" min="0" step="0.1"/>
        </div>
        <div class="form-group">
          <label>Reload Mass</label>
          <input type="number" name="system.reloadMass" value="{{system.reloadMass}}" data-dtype="Number" min="0" step="0.1"/>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Affiliation</label>
          <input type="text" name="system.affiliation" value="{{system.affiliation}}" placeholder="e.g., IS, Clan"/>
        </div>
      </div>

      <div class="form-group full-width">
        <label>Notes</label>
        <input type="text" name="system.notes" value="{{system.notes}}"/>
      </div>

      <h3>Animation</h3>
      <div class="form-group full-width">
        <label>Sequencer Animation Path</label>
        <input type="text" name="system.animation" value="{{system.animation}}" placeholder="e.g., jb2a.bullet.01.orange"/>
        <p class="hint">Sequencer-compatible animation path for projectile effects. Requires the Sequencer module.</p>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Repeat Delay (ms)</label>
          <input type="number" name="system.animationDelay" value="{{system.animationDelay}}" data-dtype="Number" min="0" step="10"/>
          <p class="hint">Delay between bullets in burst/suppression fire.</p>
        </div>
        <div class="form-group">
          <label>Duration (ms)</label>
          <input type="number" name="system.animationDuration" value="{{system.animationDuration}}" data-dtype="Number" min="0" step="50"/>
          <p class="hint">Time for projectile to reach target. 0 = use default.</p>
        </div>
      </div>
    </div>

    <div class="tab effects" data-group="primary" data-tab="effects">
      {{> "systems/mech-foundry/templates/item/parts/item-effects.hbs"}}
    </div>

    <div class="tab description" data-group="primary" data-tab="description">
      <div class="editor-container">
        {{editor system.description target="system.description" button=true owner=owner editable=editable}}
      </div>
    </div>
  </section>
</form>
