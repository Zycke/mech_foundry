<form class="{{cssClass}} mech-foundry npc-sheet" autocomplete="off">
  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="80" width="80"/>
    <div class="header-fields">
      <h1 class="charname">
        <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'MECHFOUNDRY.Name'}}"/>
      </h1>
      <div class="header-details">
        <div class="field">
          <label>{{localize "MECHFOUNDRY.Role"}}</label>
          <input type="text" name="system.role" value="{{system.role}}" />
        </div>
        <div class="field">
          <label>{{localize "MECHFOUNDRY.Threat"}}</label>
          <input type="number" name="system.threat" value="{{system.threat}}" data-dtype="Number"/>
        </div>
      </div>
    </div>
    <div class="header-combat">
      <div class="movement-rates compact">
        <span>Walk: {{system.movement.walk}}m</span>
        <span>Run: {{system.movement.run}}m</span>
      </div>
      <div class="armor-bar">
        <label>BAR</label>
        <span class="bar-value">{{equippedBAR}}</span>
      </div>
    </div>
  </header>

  {{!-- Condition Monitor --}}
  <section class="condition-monitor compact">
    <div class="damage-tracker">
      <div class="tracker-row">
        <label>Damage</label>
        <input type="number" name="system.damage.value" value="{{system.damage.value}}" data-dtype="Number"/>
        <span>/ {{system.damageCapacity}}</span>
      </div>
      <div class="tracker-row">
        <label>Fatigue</label>
        <input type="number" name="system.fatigue.value" value="{{system.fatigue.value}}" data-dtype="Number"/>
        <span>/ {{system.fatigueCapacity}}</span>
      </div>
    </div>
    <div class="stun-indicator {{#if system.stun}}active{{/if}}">
      <label>
        <input type="checkbox" name="system.stun" {{#if system.stun}}checked{{/if}}/>
        Stunned
      </label>
    </div>
  </section>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="stats">{{localize "MECHFOUNDRY.Stats"}}</a>
    <a class="item" data-tab="combat">{{localize "MECHFOUNDRY.Combat"}}</a>
    <a class="item" data-tab="biography">{{localize "MECHFOUNDRY.Biography"}}</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">

    {{!-- Stats Tab --}}
    <div class="tab stats" data-group="primary" data-tab="stats">
      {{!-- Compact Attributes --}}
      <div class="attributes-compact">
        {{#each system.attributes as |attr key|}}
        <div class="attribute-compact">
          <span class="attr-label">{{key}}</span>
          <input type="number" name="system.attributes.{{key}}.value" value="{{attr.value}}" data-dtype="Number"/>
          <span class="link-mod">({{formatMod attr.linkMod}})</span>
          <button type="button" class="attribute-roll" data-attribute="{{key}}">
            <i class="fas fa-dice"></i>
          </button>
        </div>
        {{/each}}
      </div>

      {{!-- Skills --}}
      <div class="skills-section">
        <div class="items-header flexrow">
          <h3>{{localize "MECHFOUNDRY.Skills"}}</h3>
          <a class="item-create" data-type="skill"><i class="fas fa-plus"></i></a>
        </div>
        <ul class="items-list skills-list compact">
          {{#each skills}}
          <li class="item flexrow" data-item-id="{{this._id}}">
            <span class="item-name skill-roll">{{this.name}}</span>
            <span class="skill-level">{{formatMod this.effectiveLevel}}</span>
            <div class="item-controls">
              <a class="item-edit"><i class="fas fa-edit"></i></a>
              <a class="item-delete"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ul>
      </div>

      {{!-- Traits --}}
      <div class="traits-section">
        <div class="items-header flexrow">
          <h3>{{localize "MECHFOUNDRY.Traits"}}</h3>
          <a class="item-create" data-type="trait"><i class="fas fa-plus"></i></a>
        </div>
        <ul class="items-list traits-list compact">
          {{#each traits}}
          <li class="item flexrow" data-item-id="{{this._id}}">
            <span class="item-name">{{this.name}}</span>
            <div class="item-controls">
              <a class="item-edit"><i class="fas fa-edit"></i></a>
              <a class="item-delete"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ul>
      </div>
    </div>

    {{!-- Combat Tab --}}
    <div class="tab combat" data-group="primary" data-tab="combat">
      <div class="weapons-section">
        <div class="items-header flexrow">
          <h3>{{localize "MECHFOUNDRY.Weapons"}}</h3>
          <a class="item-create" data-type="weapon"><i class="fas fa-plus"></i></a>
        </div>
        <ul class="items-list weapons-list">
          {{#each weapons}}
          <li class="item flexrow" data-item-id="{{this._id}}">
            <span class="item-name">{{this.name}}</span>
            <span class="weapon-stats">AP:{{this.system.ap}} BD:{{this.system.bd}}</span>
            <div class="item-controls">
              <a class="item-edit"><i class="fas fa-edit"></i></a>
              <a class="item-delete"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ul>
      </div>

      <div class="armor-section">
        <div class="items-header flexrow">
          <h3>{{localize "MECHFOUNDRY.Armor"}}</h3>
          <a class="item-create" data-type="armor"><i class="fas fa-plus"></i></a>
        </div>
        <ul class="items-list armor-list">
          {{#each armor}}
          <li class="item flexrow" data-item-id="{{this._id}}">
            <span class="armor-toggle">{{#if this.system.equipped}}<i class="fas fa-check"></i>{{/if}}</span>
            <span class="item-name">{{this.name}}</span>
            <span>BAR:{{this.system.bar}}</span>
            <div class="item-controls">
              <a class="item-edit"><i class="fas fa-edit"></i></a>
              <a class="item-delete"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ul>
      </div>
    </div>

    {{!-- Biography Tab --}}
    <div class="tab biography" data-group="primary" data-tab="biography">
      <div class="editor-container">
        {{editor system.biography target="system.biography" button=true owner=owner editable=editable}}
      </div>
    </div>

  </section>
</form>
