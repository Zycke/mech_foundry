<form class="{{cssClass}} mech-foundry character-sheet" autocomplete="off">
  {{!-- Sheet Header - Personal Data --}}
  <header class="sheet-header">
    <div class="header-left">
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100"/>
    </div>
    <div class="header-center">
      <div class="personal-data-section">
        <h2 class="section-title">Personal Data</h2>
        <div class="personal-data-grid">
          <div class="field name-field">
            <label>Name</label>
            <input type="text" name="name" value="{{actor.name}}" placeholder="Character Name"/>
          </div>
          <div class="field">
            <label>Player</label>
            <input type="text" name="system.personalData.player" value="{{system.personalData.player}}"/>
          </div>
          <div class="field">
            <label>Height</label>
            <input type="text" name="system.personalData.height" value="{{system.personalData.height}}" placeholder="cm"/>
          </div>
          <div class="field">
            <label>Weight</label>
            <input type="text" name="system.personalData.weight" value="{{system.personalData.weight}}" placeholder="kg"/>
          </div>
          <div class="field">
            <label>Affiliation</label>
            <input type="text" name="system.affiliation" value="{{system.affiliation}}"/>
          </div>
          <div class="field">
            <label>Hair</label>
            <input type="text" name="system.personalData.hair" value="{{system.personalData.hair}}"/>
          </div>
          <div class="field">
            <label>Eyes</label>
            <input type="text" name="system.personalData.eyes" value="{{system.personalData.eyes}}"/>
          </div>
          <div class="field">
            <label>Extra</label>
            <input type="text" name="system.personalData.extra" value="{{system.personalData.extra}}"/>
          </div>
        </div>
      </div>
    </div>
  </header>

  {{!-- XP Display Bar (Always Visible) --}}
  <div class="xp-bar">
    <div class="xp-bar-item">
      <label>Available XP</label>
      <input type="number" name="system.xp.value" class="xp-input available" value="{{system.xp.value}}" data-dtype="Number" min="0"/>
    </div>
    <div class="xp-bar-item">
      <label>Spent XP</label>
      <span class="xp-value spent">{{system.xp.spent}}</span>
    </div>
    <div class="xp-bar-item">
      <label>Total XP</label>
      <span class="xp-value total">{{system.xp.total}}</span>
    </div>
  </div>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="attributes">Attributes</a>
    <a class="item" data-tab="skills">Skills</a>
    <a class="item" data-tab="traits">Traits</a>
    <a class="item" data-tab="combat">Combat</a>
    <a class="item" data-tab="inventory">Inventory</a>
    <a class="item" data-tab="biography">Biography</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">

    {{!-- Attributes Tab --}}
    <div class="tab attributes" data-group="primary" data-tab="attributes">
      <div class="attributes-section">
        <h3 class="section-title">Attributes</h3>
        <table class="attributes-table">
          <thead>
            <tr>
              <th>Attribute</th>
              <th>Score</th>
              <th>Link</th>
              <th>XP Invested</th>
              <th>Next Rank</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr class="attribute-row" data-attribute="str">
              <td class="attribute-name">STR</td>
              <td class="attribute-score">
                <span class="score-display">{{system.attributes.str.value}}</span>
              </td>
              <td class="attribute-link {{#if (gt system.attributes.str.linkMod 0)}}positive{{else if (lt system.attributes.str.linkMod 0)}}negative{{/if}}">
                {{formatMod system.attributes.str.linkMod}}
              </td>
              <td class="attribute-xp">
                <input type="number" class="xp-input attr-xp-input" value="{{system.attributes.str.xp}}" data-dtype="Number" data-attr="str" min="0"/>
              </td>
              <td class="attribute-next-cost">{{xpCosts.attributeNext.str}} XP</td>
              <td class="attribute-roll-cell">
                <button type="button" class="attribute-roll" data-attribute="str" title="Roll STR (Shift+Click for Double)">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </td>
            </tr>
            <tr class="attribute-row" data-attribute="bod">
              <td class="attribute-name">BOD</td>
              <td class="attribute-score">
                <span class="score-display">{{system.attributes.bod.value}}</span>
              </td>
              <td class="attribute-link {{#if (gt system.attributes.bod.linkMod 0)}}positive{{else if (lt system.attributes.bod.linkMod 0)}}negative{{/if}}">
                {{formatMod system.attributes.bod.linkMod}}
              </td>
              <td class="attribute-xp">
                <input type="number" class="xp-input attr-xp-input" value="{{system.attributes.bod.xp}}" data-dtype="Number" data-attr="bod" min="0"/>
              </td>
              <td class="attribute-next-cost">{{xpCosts.attributeNext.bod}} XP</td>
              <td class="attribute-roll-cell">
                <button type="button" class="attribute-roll" data-attribute="bod" title="Roll BOD (Shift+Click for Double)">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </td>
            </tr>
            <tr class="attribute-row" data-attribute="rfl">
              <td class="attribute-name">RFL</td>
              <td class="attribute-score">
                <span class="score-display">{{system.attributes.rfl.value}}</span>
              </td>
              <td class="attribute-link {{#if (gt system.attributes.rfl.linkMod 0)}}positive{{else if (lt system.attributes.rfl.linkMod 0)}}negative{{/if}}">
                {{formatMod system.attributes.rfl.linkMod}}
              </td>
              <td class="attribute-xp">
                <input type="number" class="xp-input attr-xp-input" value="{{system.attributes.rfl.xp}}" data-dtype="Number" data-attr="rfl" min="0"/>
              </td>
              <td class="attribute-next-cost">{{xpCosts.attributeNext.rfl}} XP</td>
              <td class="attribute-roll-cell">
                <button type="button" class="attribute-roll" data-attribute="rfl" title="Roll RFL (Shift+Click for Double)">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </td>
            </tr>
            <tr class="attribute-row" data-attribute="dex">
              <td class="attribute-name">DEX</td>
              <td class="attribute-score">
                <span class="score-display">{{system.attributes.dex.value}}</span>
              </td>
              <td class="attribute-link {{#if (gt system.attributes.dex.linkMod 0)}}positive{{else if (lt system.attributes.dex.linkMod 0)}}negative{{/if}}">
                {{formatMod system.attributes.dex.linkMod}}
              </td>
              <td class="attribute-xp">
                <input type="number" class="xp-input attr-xp-input" value="{{system.attributes.dex.xp}}" data-dtype="Number" data-attr="dex" min="0"/>
              </td>
              <td class="attribute-next-cost">{{xpCosts.attributeNext.dex}} XP</td>
              <td class="attribute-roll-cell">
                <button type="button" class="attribute-roll" data-attribute="dex" title="Roll DEX (Shift+Click for Double)">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </td>
            </tr>
            <tr class="attribute-row" data-attribute="int">
              <td class="attribute-name">INT</td>
              <td class="attribute-score">
                <span class="score-display">{{system.attributes.int.value}}</span>
              </td>
              <td class="attribute-link {{#if (gt system.attributes.int.linkMod 0)}}positive{{else if (lt system.attributes.int.linkMod 0)}}negative{{/if}}">
                {{formatMod system.attributes.int.linkMod}}
              </td>
              <td class="attribute-xp">
                <input type="number" class="xp-input attr-xp-input" value="{{system.attributes.int.xp}}" data-dtype="Number" data-attr="int" min="0"/>
              </td>
              <td class="attribute-next-cost">{{xpCosts.attributeNext.int}} XP</td>
              <td class="attribute-roll-cell">
                <button type="button" class="attribute-roll" data-attribute="int" title="Roll INT (Shift+Click for Double)">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </td>
            </tr>
            <tr class="attribute-row" data-attribute="wil">
              <td class="attribute-name">WIL</td>
              <td class="attribute-score">
                <span class="score-display">{{system.attributes.wil.value}}</span>
              </td>
              <td class="attribute-link {{#if (gt system.attributes.wil.linkMod 0)}}positive{{else if (lt system.attributes.wil.linkMod 0)}}negative{{/if}}">
                {{formatMod system.attributes.wil.linkMod}}
              </td>
              <td class="attribute-xp">
                <input type="number" class="xp-input attr-xp-input" value="{{system.attributes.wil.xp}}" data-dtype="Number" data-attr="wil" min="0"/>
              </td>
              <td class="attribute-next-cost">{{xpCosts.attributeNext.wil}} XP</td>
              <td class="attribute-roll-cell">
                <button type="button" class="attribute-roll" data-attribute="wil" title="Roll WIL (Shift+Click for Double)">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </td>
            </tr>
            <tr class="attribute-row" data-attribute="cha">
              <td class="attribute-name">CHA</td>
              <td class="attribute-score">
                <span class="score-display">{{system.attributes.cha.value}}</span>
              </td>
              <td class="attribute-link {{#if (gt system.attributes.cha.linkMod 0)}}positive{{else if (lt system.attributes.cha.linkMod 0)}}negative{{/if}}">
                {{formatMod system.attributes.cha.linkMod}}
              </td>
              <td class="attribute-xp">
                <input type="number" class="xp-input attr-xp-input" value="{{system.attributes.cha.xp}}" data-dtype="Number" data-attr="cha" min="0"/>
              </td>
              <td class="attribute-next-cost">{{xpCosts.attributeNext.cha}} XP</td>
              <td class="attribute-roll-cell">
                <button type="button" class="attribute-roll" data-attribute="cha" title="Roll CHA (Shift+Click for Double)">
                  <i class="fas fa-dice-d6"></i>
                </button>
              </td>
            </tr>
            <tr class="attribute-row edge-row" data-attribute="edg">
              <td class="attribute-name">EDG</td>
              <td class="attribute-score">
                <span class="score-display">{{system.attributes.edg.value}}</span>
              </td>
              <td class="attribute-link edge-current">
                {{system.attributes.edg.current}}
              </td>
              <td class="attribute-xp">
                <input type="number" class="xp-input attr-xp-input" value="{{system.attributes.edg.xp}}" data-dtype="Number" data-attr="edg" min="0"/>
              </td>
              <td class="attribute-next-cost">{{xpCosts.attributeNext.edg}} XP</td>
              <td class="attribute-roll-cell">
                <button type="button" class="burn-edge" title="Burn Edge">
                  <i class="fas fa-fire"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    {{!-- Skills Tab --}}
    <div class="tab skills" data-group="primary" data-tab="skills">
      <div class="skills-section">
        <div class="items-header">
          <h3 class="section-title">Skills</h3>
          <a class="item-create" data-type="skill"><i class="fas fa-plus"></i> Add Skill</a>
        </div>
        <table class="skills-table">
          <thead>
            <tr>
              <th>Skill</th>
              <th>Total Mod</th>
              <th>Level</th>
              <th>Links</th>
              <th>TN/C</th>
              <th>XP Invested</th>
              <th>Next Level</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each skills}}
            <tr class="item skill-row" data-item-id="{{this._id}}">
              <td class="skill-name">
                <a class="skill-roll" title="Click to roll">
                  <i class="fas fa-dice"></i> {{this.name}}
                </a>
              </td>
              <td class="skill-total-mod">{{formatMod this.effectiveLevel}}</td>
              <td class="skill-level">{{formatMod this.system.level}}</td>
              <td class="skill-links">
                {{this.system.linkedAttribute1}}{{#if this.system.linkedAttribute2}}+{{this.system.linkedAttribute2}}{{/if}}
                ({{formatMod this.totalLinkMod}})
              </td>
              <td class="skill-tn">{{this.system.targetNumber}}/{{this.system.complexity}}</td>
              <td class="skill-xp">
                <input type="number" class="xp-input skill-xp-input" value="{{this.system.xp}}" data-item-id="{{this._id}}" data-dtype="Number" min="0"/>
              </td>
              <td class="skill-next-cost">{{this.nextLevelCost}} XP</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>

    {{!-- Traits Tab --}}
    <div class="tab traits" data-group="primary" data-tab="traits">
      <div class="traits-section">
        <div class="items-header">
          <h3 class="section-title">Traits (Personal)</h3>
          <a class="item-create" data-type="trait"><i class="fas fa-plus"></i> Add Trait</a>
        </div>
        <table class="traits-table">
          <thead>
            <tr>
              <th>Trait</th>
              <th>TP</th>
              <th>Page Ref.</th>
              <th>XP Cost</th>
              <th>XP Invested</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each traits}}
            <tr class="item trait-row {{this.system.traitType}}" data-item-id="{{this._id}}">
              <td class="trait-name">
                <span class="trait-indicator">{{#if (eq this.system.traitType "positive")}}+{{else}}-{{/if}}</span>
                {{this.name}}
              </td>
              <td class="trait-cost">{{this.system.cost}}</td>
              <td class="trait-pageref">{{this.system.pageRef}}</td>
              <td class="trait-xpcost">{{this.xpCost}}</td>
              <td class="trait-xp">
                <input type="number" class="xp-input trait-xp-input" value="{{this.system.xp}}" data-item-id="{{this._id}}" data-xp-cost="{{this.xpCost}}" data-dtype="Number" min="0"/>
                {{#if this.system.purchased}}
                <span class="purchased"><i class="fas fa-check"></i></span>
                {{/if}}
              </td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>

    {{!-- Combat Tab --}}
    <div class="tab combat" data-group="primary" data-tab="combat">
      <div class="combat-layout">
        {{!-- Left Column: Condition Monitor --}}
        <div class="combat-column condition-column">
          <div class="combat-data-section">
            <h3 class="section-title">Condition Monitor</h3>

            {{!-- Standard Damage Track --}}
            <div class="condition-track damage-track">
              <label>Standard Damage</label>
              <div class="condition-boxes">
                {{#times system.damageCapacity}}
                <span class="condition-box {{#if (lt this @root.system.damage.value)}}filled{{/if}}" data-index="{{this}}" data-type="damage"></span>
                {{/times}}
              </div>
              <input type="number" class="condition-input" name="system.damage.value" value="{{system.damage.value}}" min="0" max="{{system.damageCapacity}}" data-dtype="Number" data-max="{{system.damageCapacity}}"/>
            </div>

            {{!-- Fatigue Track --}}
            <div class="condition-track fatigue-track">
              <label>Fatigue Damage</label>
              <div class="condition-boxes">
                {{#times system.fatigueCapacity}}
                <span class="condition-box {{#if (lt this @root.system.fatigue.value)}}filled{{/if}}" data-index="{{this}}" data-type="fatigue"></span>
                {{/times}}
              </div>
              <input type="number" class="condition-input" name="system.fatigue.value" value="{{system.fatigue.value}}" min="0" max="{{system.fatigueCapacity}}" data-dtype="Number" data-max="{{system.fatigueCapacity}}"/>
            </div>

            {{!-- Status Checkboxes --}}
            <div class="status-row">
              <label class="status-checkbox">
                <input type="checkbox" name="system.stun" {{#if system.stun}}checked{{/if}}/>
                Stun
              </label>
              <label class="status-checkbox">
                <input type="checkbox" name="system.unconscious" {{#if system.unconscious}}checked{{/if}}/>
                Unconscious
              </label>
            </div>

            {{!-- Condition Modifiers --}}
            <div class="condition-modifiers">
              {{#if (lt system.injuryModifier 0)}}
              <span class="modifier injury">Injury: {{system.injuryModifier}}</span>
              {{/if}}
              {{#if (lt system.fatigueModifier 0)}}
              <span class="modifier fatigue">Fatigue: {{system.fatigueModifier}}</span>
              {{/if}}
            </div>

            {{!-- Action Buttons --}}
            <div class="condition-actions">
              <button type="button" class="recover-fatigue" title="Recover Fatigue (Complex Action)">
                <i class="fas fa-heart"></i> Recover Fatigue
              </button>
              <button type="button" class="clear-stun" title="Clear Stun (Simple Action)">
                <i class="fas fa-bolt"></i> Clear Stun
              </button>
              <button type="button" class="consciousness-check" title="Consciousness Check (TN 7)">
                <i class="fas fa-brain"></i> Consciousness
              </button>
            </div>
          </div>

          {{!-- Movement Section --}}
          <div class="movement-section">
            <h3 class="section-title">Movement (Meters per Turn)</h3>
            <div class="movement-grid">
              <div class="movement-item">
                <label>Walk</label>
                <span class="movement-value">{{system.movement.walk}}</span>
              </div>
              <div class="movement-item">
                <label>Climb</label>
                <span class="movement-value">{{system.movement.climb}}</span>
              </div>
              <div class="movement-item">
                <label>Run/Evade</label>
                <span class="movement-value">{{system.movement.run}}</span>
              </div>
              <div class="movement-item">
                <label>Crawl</label>
                <span class="movement-value">{{system.movement.crawl}}</span>
              </div>
              <div class="movement-item">
                <label>Sprint</label>
                <span class="movement-value">{{system.movement.sprint}}</span>
              </div>
              <div class="movement-item">
                <label>Swim</label>
                <span class="movement-value">{{system.movement.swim}}</span>
              </div>
            </div>
          </div>
        </div>

        {{!-- Right Column: Armor & Weapons --}}
        <div class="combat-column equipment-column">
          {{!-- Personal Armor Section --}}
          <div class="armor-section">
            <div class="items-header">
              <h3 class="section-title">Personal Armor</h3>
              <a class="item-create" data-type="armor"><i class="fas fa-plus"></i></a>
            </div>
            <table class="armor-table">
              <thead>
                <tr>
                  <th></th>
                  <th>Location</th>
                  <th>Armor Type</th>
                  <th colspan="4">BAR (M/B/E/X)</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {{#each armor}}
                <tr class="item" data-item-id="{{this._id}}">
                  <td class="armor-equipped">
                    <span class="armor-toggle" title="Toggle Equipped">
                      {{#if this.system.equipped}}<i class="fas fa-check-circle"></i>{{else}}<i class="far fa-circle"></i>{{/if}}
                    </span>
                  </td>
                  <td class="armor-location">{{this.system.location}}</td>
                  <td class="armor-type">{{this.name}}</td>
                  <td class="armor-bar">{{this.system.bar.m}}</td>
                  <td class="armor-bar">{{this.system.bar.b}}</td>
                  <td class="armor-bar">{{this.system.bar.e}}</td>
                  <td class="armor-bar">{{this.system.bar.x}}</td>
                  <td class="item-controls">
                    <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                    <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                  </td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>

          {{!-- Weapons Section --}}
          <div class="weapons-section">
            <div class="items-header">
              <h3 class="section-title">Weapons</h3>
              <a class="item-create" data-type="weapon"><i class="fas fa-plus"></i></a>
            </div>
            <table class="weapons-table">
              <thead>
                <tr>
                  <th>Weapon</th>
                  <th>Skill</th>
                  <th>AP/BD</th>
                  <th>Range</th>
                  <th>Ammo</th>
                  <th>Notes</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {{#each weapons}}
                <tr class="item" data-item-id="{{this._id}}">
                  <td class="weapon-name">{{this.name}}</td>
                  <td class="weapon-skill">{{this.system.skill}}</td>
                  <td class="weapon-apbd">{{this.system.ap}}/{{this.system.bd}}{{#if this.system.subduing}}D{{/if}}</td>
                  <td class="weapon-range">
                    {{#if (eq this.system.weaponType "melee")}}
                    Melee
                    {{else}}
                    {{this.system.range.short}}/{{this.system.range.medium}}/{{this.system.range.long}}
                    {{/if}}
                  </td>
                  <td class="weapon-ammo">
                    {{#if this.system.ammo.max}}
                    {{this.system.ammo.value}}/{{this.system.ammo.max}}
                    {{else}}
                    N/A
                    {{/if}}
                  </td>
                  <td class="weapon-notes">{{this.system.notes}}</td>
                  <td class="item-controls">
                    <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                    <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
                  </td>
                </tr>
                {{/each}}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    {{!-- Inventory Tab --}}
    <div class="tab inventory" data-group="primary" data-tab="inventory">
      {{!-- C-Bills and Weight Bar --}}
      <div class="inventory-header-bar">
        <div class="cbills-section">
          <label>C-Bills</label>
          <input type="number" name="system.cbills" value="{{system.cbills}}" data-dtype="Number" min="0"/>
        </div>
        <div class="weight-section">
          <label>Carried Weight</label>
          <span class="weight-value">{{inventory.totalWeight}} kg</span>
        </div>
        <div class="add-item-section">
          <button type="button" class="add-inventory-item"><i class="fas fa-plus"></i> Add Item</button>
        </div>
      </div>

      {{!-- Armor Category --}}
      {{#if inventory.armor.length}}
      <div class="inventory-category armor-category">
        <h3 class="section-title">Armor</h3>
        <table class="inventory-table">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>BAR (M/B/E/X)</th>
              <th>Coverage</th>
              <th>Mass</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.armor}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "equipped")}}<i class="fas fa-shield-alt"></i>{{else if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">{{this.name}}</td>
              <td class="armor-bar">{{this.system.bar.m}}/{{this.system.bar.b}}/{{this.system.bar.e}}/{{this.system.bar.x}}</td>
              <td class="armor-coverage">
                {{#if this.system.coverage.head}}H{{/if}}{{#if this.system.coverage.torso}}T{{/if}}{{#if this.system.coverage.arms}}A{{/if}}{{#if this.system.coverage.legs}}L{{/if}}
              </td>
              <td class="item-mass">{{this.system.mass}}</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Weapons Category --}}
      {{#if inventory.weapons.length}}
      <div class="inventory-category weapons-category">
        <h3 class="section-title">Weapons</h3>
        <table class="inventory-table centered-data">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>Skill</th>
              <th>AP/BD</th>
              <th>Range (PB/S/M/L/E)</th>
              <th>Ammo</th>
              <th>Mass</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.weapons}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "equipped")}}<i class="fas fa-hand-rock"></i>{{else if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">
                <a class="weapon-attack-roll" title="Click to attack">{{this.name}}</a>
              </td>
              <td class="weapon-skill">{{this.system.skill}}</td>
              <td class="weapon-apbd">{{this.system.ap}}{{this.system.apFactor}}/{{this.system.bd}}{{this.system.bdFactor}}</td>
              <td class="weapon-range">
                {{#if (eq this.system.weaponType "melee")}}Melee{{else}}{{this.system.range.pointBlank}}/{{this.system.range.short}}/{{this.system.range.medium}}/{{this.system.range.long}}/{{this.system.range.extreme}}{{/if}}
              </td>
              <td class="weapon-ammo">{{#if this.system.ammo.max}}{{this.system.ammo.value}}/{{this.system.ammo.max}}{{else}}â€”{{/if}}</td>
              <td class="item-mass">{{this.system.mass}}</td>
              <td class="item-controls">
                {{#if this.system.ammo.max}}<a class="weapon-reload" title="Reload"><i class="fas fa-redo"></i></a>{{/if}}
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Electronics Category --}}
      {{#if inventory.electronics.length}}
      <div class="inventory-category electronics-category">
        <h3 class="section-title">Electronics</h3>
        <table class="inventory-table">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>Range</th>
              <th>Power</th>
              <th>Mass</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.electronics}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">{{this.name}}</td>
              <td class="item-range">{{this.system.range}}</td>
              <td class="item-power">{{this.system.powerUse}}</td>
              <td class="item-mass">{{this.system.mass}}</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Power Packs Category --}}
      {{#if inventory.powerpacks.length}}
      <div class="inventory-category powerpacks-category">
        <h3 class="section-title">Power Packs</h3>
        <table class="inventory-table">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>Capacity</th>
              <th>Mass</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.powerpacks}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">{{this.name}}</td>
              <td class="item-capacity">{{this.system.powerCapacity}}</td>
              <td class="item-mass">{{this.system.mass}}</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Health Care Category --}}
      {{#if inventory.healthcare.length}}
      <div class="inventory-category healthcare-category">
        <h3 class="section-title">Health Care</h3>
        <table class="inventory-table">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>Power</th>
              <th>Mass</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.healthcare}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">{{this.name}}</td>
              <td class="item-power">{{this.system.powerUse}}</td>
              <td class="item-mass">{{this.system.mass}}</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Prosthetics Category --}}
      {{#if inventory.prosthetics.length}}
      <div class="inventory-category prosthetics-category">
        <h3 class="section-title">Prosthetics</h3>
        <table class="inventory-table">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>Notes</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.prosthetics}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">{{this.name}}</td>
              <td class="item-notes">{{this.system.notes}}</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Drugs & Poisons Category --}}
      {{#if inventory.drugpoisons.length}}
      <div class="inventory-category drugpoisons-category">
        <h3 class="section-title">Drugs & Poisons</h3>
        <table class="inventory-table">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>Strength/AP</th>
              <th>Duration</th>
              <th>Mass</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.drugpoisons}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">{{this.name}}</td>
              <td class="item-strength">{{this.system.drugStrength}}/{{this.system.poisonAP}}</td>
              <td class="item-duration">{{this.system.duration}}</td>
              <td class="item-mass">{{this.system.mass}}</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Personal Vehicles Category --}}
      {{#if inventory.vehicles.length}}
      <div class="inventory-category vehicles-category">
        <h3 class="section-title">Personal Vehicles</h3>
        <table class="inventory-table">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>Type</th>
              <th>Speed</th>
              <th>Range</th>
              <th>Crew/Pass</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.vehicles}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">{{this.name}}</td>
              <td class="vehicle-type">{{this.system.vehicleType}}</td>
              <td class="vehicle-speed">{{this.system.speed}}</td>
              <td class="vehicle-range">{{this.system.range}}</td>
              <td class="vehicle-crew">{{this.system.crew}}/{{this.system.passengers}}</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Fuel Category --}}
      {{#if inventory.fuel.length}}
      <div class="inventory-category fuel-category">
        <h3 class="section-title">Fuel</h3>
        <table class="inventory-table">
          <thead>
            <tr>
              <th class="status-col"></th>
              <th>Name</th>
              <th>Type</th>
              <th>Mass</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {{#each inventory.fuel}}
            <tr class="item" data-item-id="{{this._id}}">
              <td class="item-status">
                <a class="carry-status-toggle" data-status="{{this.system.carryStatus}}" title="{{this.system.carryStatus}}">
                  {{#if (eq this.system.carryStatus "carried")}}<i class="fas fa-suitcase"></i>{{else}}<i class="fas fa-warehouse"></i>{{/if}}
                </a>
              </td>
              <td class="item-name">{{this.name}}</td>
              <td class="fuel-type">{{this.system.fuelType}}</td>
              <td class="item-mass">{{this.system.mass}}</td>
              <td class="item-controls">
                <a class="item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      {{/if}}

      {{!-- Empty inventory message --}}
      {{#unless inventory.hasItems}}
      <div class="inventory-empty">
        <p>No items in inventory. Click "Add Item" or drag items here to add them.</p>
      </div>
      {{/unless}}
    </div>

    {{!-- Biography Tab --}}
    <div class="tab biography" data-group="primary" data-tab="biography">
      {{!-- Life Modules Section --}}
      <div class="lifemodules-section">
        <h3 class="section-title">Biography - Life Modules</h3>
        <table class="lifemodules-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Life Module</th>
              <th>Other Notes</th>
            </tr>
          </thead>
          <tbody>
            {{#each system.lifeModules as |module key|}}
            <tr class="lifemodule-row">
              <td class="lifemodule-number">{{key}}</td>
              <td class="lifemodule-name">
                <input type="text" name="system.lifeModules.{{key}}.name" value="{{module.name}}" placeholder="{{#if (eq key '1')}}Early Childhood{{else if (eq key '2')}}Late Childhood{{/if}}"/>
              </td>
              <td class="lifemodule-notes">
                <input type="text" name="system.lifeModules.{{key}}.notes" value="{{module.notes}}"/>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      {{!-- Other Notes / Biography --}}
      <div class="biography-section">
        <h3 class="section-title">Other Notes</h3>
        <div class="editor-container">
          {{editor system.biography target="system.biography" button=true owner=owner editable=editable}}
        </div>
      </div>
    </div>

  </section>
</form>
